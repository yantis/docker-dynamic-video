{"name":"Docker-dynamic-video","tagline":"Dynamic Video Drivers with X-Server on Docker. (Should work with Mesa & Nvidia 304.XX, 340.XX, 346.XX, and 349.XX series drivers (All?)) . Includes all 32 bit & 64 bit libraries.","body":"# docker-dynamic-video\r\nDynamic Video Drivers with optional X-Server on Docker. (Should work with Mesa & Nvidia 304.XX, 340.XX, 346.XX, and 349.XX series drivers (All?)) \r\nIncludes all 32 bit & 64 bit libraries as well so it should work out of the box with\r\n[VirtualGL](https://github.com/yantis/docker-virtualgl), Wine, PlayonLinux etc.\r\n\r\nThe default mode is to start up the X-Server and SSH daemon but if you start it up with any command it will just default to that and not start up any servers.\r\nThough if you do not startup any servers you do need to do the first time video initalization yourself. See the local usage section below.\r\n\r\nOn Docker hub [dynamic-video](https://registry.hub.docker.com/u/yantis/dynamic-video/)\r\non Github [docker-dynamic-video](https://github.com/yantis/docker-dynamic-video)\r\n\r\n\r\n# Description\r\nThe goal of this was a layer between [ssh-hpn-x](https://github.com/yantis/docker-ssh-hpn-x) and graphical applications.\r\nThat would just work with whatever video hardware someone had. Right now it defaults to Mesa but if it sees\r\nthat the host is using an Nvidia driver it will switch over to that one. It should support all Nvidia drivers.\r\nThis could also easily do the same for ATI but as I don't have one of those cards I am unable to test it.\r\nYou can fork this and add it yourself or if you send me SSH access to a server with an ATI card I can build it in as well.\r\n\r\nIt works well with [VirtualGL](https://github.com/yantis/docker-virtualgl). I have ran Blender as well as even Path of Exile on an Amazon EC2 GPU instance via \r\n[VirtualGL](https://github.com/yantis/docker-virtualgl) and PlayOnLinux.\r\nAll in a Docker container. Checkout my Dockerfiles for these (If I didn't get around to putting them up. Just ask.)\r\n\r\n\r\n## Usage (Local)\r\n\r\nThis example launches the container and initalizes the graphcs with your drivers and in this case\r\nruns nvidia-smi to get video card information.\r\n\r\n```bash\r\nxhost +si:localuser:$(whoami) >/dev/null\r\ndocker run \\\r\n    --privileged \\\r\n    --rm \\\r\n    -ti \\\r\n    -e DISPLAY \\\r\n    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n    -u docker \\\r\n    yantis/dynamic-video /bin/bash -c \"sudo initalize-graphics >/dev/null 2>/dev/null; nvidia-smi;\"\r\n```\r\n\r\n### Breakdown\r\n\r\n```bash\r\n$ xhost +si:localuser:yourusername\r\n```\r\n\r\nAllows your local user to access the xsocket. Change yourusername or use $(whoami) or $USER if your shell supports it.\r\n\r\n```bash\r\ndocker run \\\r\n        --privileged \\\r\n        --rm \\\r\n        -ti \\\r\n        -e DISPLAY \\\r\n        -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n        -u docker \\\r\n        yantis/dynamic-video /bin/bash -c \"sudo initalize-graphics >/dev/null 2>/dev/null; nvidia-smi;\"\r\n```\r\n\r\nThis follows these docker conventions:\r\n\r\n* `-ti` will run an interactive session that can be terminated with CTRL+C.\r\n* `--rm` will run a temporary session that will make sure to remove the container on exit.\r\n* `-e DISPLAY` sets the host display to the local machines display.\r\n* `-v /tmp/.X11-unix:/tmp/.X11-unix:ro` bind mounts the X11 socks on your local machine to the containers and makes it read only.\r\n* `-u docker` sets the user to docker. (or you could do root as well)\r\n* `yantis/dynamic-video /bin/bash -c \"sudo initalize-graphics >/dev/null 2>/dev/null; nvidia-smi;\"`\r\nyou need to initalize the graphics or otherwise it won't adapt to your graphics drivers and may not work.\r\n\r\n\r\n## Usage (Remote)\r\n\r\nThis example launches the container in the background.\r\nWarning: Do not run this on your primary computer in remote mode as it will launch another X server that take over\r\nyour video cards and you will have to shutdown the container to get them back.\r\n\r\n```bash\r\ndocker run \\\r\n        --privileged \\\r\n        -d \\\r\n        -v /home/user/.ssh/authorized_keys:/authorized_keys:ro \\\r\n        -h docker \\\r\n        -p 49154:22 \\\r\n        yantis/dynamic-video\r\n```\r\n\r\nThis follows these docker conventions:\r\n\r\n* `--privileged` run in privileged mode \r\nIf you do not want to run in privliged mode you can mess around with these:\r\n\r\nAWS `--device=/dev/nvidia0:/dev/nvidia0` \\  \r\n      `--device=/dev/nvidiactl:/dev/nvidiactl` \\  \r\n      `--device=/dev/nvidia-uvm:/dev/nvidia-uvm` \\  \r\n\r\nOR (Local) `--device=/dev/dri/card0:/dev/dri/card0` \\\r\n\r\n* `-d` run in daemon mode\r\n* `-h docker` sets the hostname to docker. (not really required but it is nice to see where you are.)\r\n* `-v $HOME/.ssh/authorized_keys:/authorized_keys:ro` Optionaly share your public keys with the host.\r\nThis is particularlly useful when you are running this on another server that already has SSH. Like an \r\nAmazon EC2 instance. WARNING: If you don't use this then it will just default to the user pass of docker/docker\r\n(If you do specify authorized keys it will disable all password logins to keep it secure).\r\n\r\n* `-p 49158:22` port that you will be connecting to.\r\n* `yantis/dynamic-video` the default mode is SSH server with the X-Server so no need to run any commands.\r\n\r\nNow just SSH into it and use it (See [docker-virtualgl](https://github.com/yantis/docker-virtualgl) for how to access it and usage etc.)\r\n\r\n\r\n# Tested\r\n* Macbook Retina with Mesa drivers.\r\n\r\n* Nvidia 349.xx OK  (Current Beta Drivers)\r\n![](http://yantis-scripts.s3.amazonaws.com/screenshot_20150412-070107.jpg)\r\n\r\n* Nvidia 346.xx OK  (Current Generation Drivers) (This one is an Amazon EC2 GPU instance)\r\n![](http://yantis-scripts.s3.amazonaws.com/screenshot_20150412-071934.jpg)\r\n\r\n* Nvidia 340.xx OK (Previous Generation Drivers)\r\n![](http://yantis-scripts.s3.amazonaws.com/screenshot_20150412-071443.jpg)\r\n\r\n","google":"UA-61848149-1","note":"Don't delete this file! It's used internally to help with page regeneration."}